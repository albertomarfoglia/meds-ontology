@prefix : <https://albertomarfoglia.github.io/meds-ontology#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix meds: <https://albertomarfoglia.github.io/meds-ontology#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dct:    <http://purl.org/dc/terms#> .
@prefix dcat:   <http://www.w3.org/ns/dcat#> .
@prefix prov:   <http://www.w3.org/ns/prov#> .
@base <https://albertomarfoglia.github.io/meds-ontology#> .

<https://albertomarfoglia.github.io/meds-ontology> a owl:Ontology ;
    dct:title "MEDS conceptual ontology (OWL)" ;
    dct:creator "Alberto Marfoglia" ;
    dct:description "An OWL ontology encoding the MEDS data model (subjects, events, codes, labels, dataset metadata, splits). This ontology intentionally models open/extendable value modalities and captures MEDS invariants as annotations where OWL cannot enforce them." ;
    dct:created "2025-12-04"^^xsd:date ;
    owl:versionInfo "0.1.0" .

dct:title a owl:DatatypeProperty .
dct:created a owl:DatatypeProperty .
dct:hasVersion a owl:ObjectProperty .

#################################################################
#    Classes
#################################################################
###  https://albertomarfoglia.github.io/meds-ontology#Code
:Code a owl:Class ;
    rdfs:label "Code" ;
    rdfs:comment "Metadata/vocabulary entry describing a event code (code string, description, parent codes, external links)." .

meds:DatasetMetadata
    a owl:Class ;
    rdfs:label "DatasetMetadata" ;
    rdfs:comment
        "High-level provenance and conversion metadata for a MEDS dataset. 
         dataset_name → dct:title ;
         dataset_version → dct:hasVersion ;
         meds_version → meds:medsVersion ;
         created_at → dct:created ;
         license → dct:license ;
         location_uri/description_uri → dcat:distribution (Distribution with dcat:downloadURL / dcat:accessURL) ;
         ETL metadata (name, version, notes) are captured via prov:wasGeneratedBy → prov:Activity (rdfs:label, dct:hasVersion, rdfs:comment);
         column lists → meds:... repeated-literal properties." ;
    rdfs:subClassOf prov:Entity , dcat:Dataset .

    
###  https://albertomarfoglia.github.io/meds-ontology#LabelSample
:LabelSample rdf:type owl:Class ;
                rdfs:comment "A prediction sample row: subject, prediction_time, and one label value (boolean/integer/float/categorical)." ;
                rdfs:label "LabelSample" .


###  https://albertomarfoglia.github.io/meds-ontology#Event
:Event rdf:type owl:Class ;
                rdfs:label "Event" ;
                rdfs:comment "A single observation/row in MEDS: (subject, time?, code, value modalities...). Time is nullable for static events." ;
                owl:disjointWith :LabelSample .


###  https://albertomarfoglia.github.io/meds-ontology#Subject
:Subject a owl:Class ;
    rdfs:label "Subject" ;
    rdfs:comment "Primary entity for which care observations are recorded. Maps to MEDS subject_id (patient or admission-level subject)." .

###  https://albertomarfoglia.github.io/meds-ontology#SubjectSplit
:SubjectSplit a owl:Class ;
    rdfs:label "SubjectSplit" ;
    rdfs:comment "An assignment of a subject to a named split (train, tuning, held_out)." .

:ValueModality a owl:Class ;
    rdfs:label "ValueModality" ;
    rdfs:comment "Generic holder for additional value modalities (image path, waveform id, etc.). Instances may contain modality-specific properties." .

:ImageValue a owl:Class ;
    rdfs:subClassOf :ValueModality ;
    rdfs:label "ImageValue" ;
    rdfs:comment "Value modality pointing to an image path/uri." .


################################################################
# Class restrictions (cardinalities & guidance)
################################################################
# Events must have exactly one subject and exactly one code; time is optional (0..1).
:Event
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty :hasSubject ;
        owl:cardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty :hasCode ;
        owl:cardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty :time ;
        owl:maxCardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty :numericValue ;
        owl:maxCardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty :textValue ;
        owl:maxCardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty prov:wasDerivedFrom ;
        owl:allValuesFrom meds:DatasetMetadata
    ]  .

:DatasetMetadata
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty dct:title ;
        owl:cardinality 1
    ] , [
        a owl:Restriction ;
        owl:onProperty dct:created ;
        owl:cardinality 1
    ] , [
        a owl:Restriction ;
        owl:onProperty dct:hasVersion ;
        owl:maxCardinality 1
    ] , [
        a owl:Restriction ;
        owl:onProperty dct:license ;
        owl:allValuesFrom dct:LicenseDocument ;
        owl:maxCardinality 1
    ] , [
        a owl:Restriction ;
        owl:onProperty meds:medsVersion ;
        owl:cardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty dcat:distribution ;    # location_uri + description_uri
        owl:allValuesFrom dcat:Distribution
    ] , [
        a owl:Restriction ;
        owl:onProperty prov:wasGeneratedBy ;  # ETL activity
        owl:allValuesFrom prov:Activity
    ] .


# Code must have exactly one codeString
 :Code
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty  :codeString ;
        owl:cardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty prov:wasDerivedFrom ;
        owl:allValuesFrom meds:DatasetMetadata
    ]  .

# LabelSample requirements: subject and predictionTime required; label value properties are optional but typically exactly one will be used.
:LabelSample
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty :hasSubject ;
        owl:cardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty  :predictionTime ;
        owl:cardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty  :booleanValue ;
        owl:maxCardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty  :integerValue ;
        owl:maxCardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty  :floatValue ;
        owl:maxCardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty  :categoricalValue ;
        owl:maxCardinality "1"^^xsd:nonNegativeInteger
    ] , [
        a owl:Restriction ;
        owl:onProperty prov:wasDerivedFrom ;
        owl:allValuesFrom meds:DatasetMetadata
    ]  .

meds:Subject rdfs:subClassOf [
    a owl:Restriction ;
    owl:onProperty prov:wasDerivedFrom ;
    owl:allValuesFrom meds:DatasetMetadata
] .

#################################################################
#    Object Properties
#################################################################
:hasSubject a owl:ObjectProperty ;
    rdfs:label "hasSubject" ;
    rdfs:domain :Event , :LabelSample ;
    rdfs:range :Subject ;
    rdfs:comment "Links a Event or LabelSample to its Subject (maps to subject_id)." .

:hasCode a owl:ObjectProperty ;
    rdfs:label "hasCode" ;
    rdfs:domain :Event ;
    rdfs:range :Code ;
    rdfs:comment "Link from a Event to a Code metadata entry. If no Code metadata file exists, codeString on Event is used." .

:hasValueModality a owl:ObjectProperty ;
    rdfs:label "hasValueModality" ;
    rdfs:domain :Event ;
    rdfs:range :ValueModality ;
    rdfs:comment "Attach additional value modalities (image, waveform, etc.) to a Event." .

:assignedSplit a owl:ObjectProperty ;
    rdfs:label "assignedSplit" ;
    rdfs:domain :Subject ;
    rdfs:range :SubjectSplit ;
    rdfs:comment "Assign a subject to a split (train, tuning, held_out)." .

:parentCode a owl:ObjectProperty ;
    rdfs:label "parentCode" ;
    rdfs:domain :Code ;
    rdfs:range :Code ;
    rdfs:comment "Ontological/aggregation parent relations between codes (maps to CodeMetadata.parent_codes)." .

#################################################################
#    Data properties
#################################################################
:subjectId a owl:DatatypeProperty , owl:FunctionalProperty ;
    rdfs:domain :Subject ;
    rdfs:range xsd:string ;
    rdfs:comment "Unique identifier for a Subject; functional (= at most one value per Subject)." .

:Subject owl:hasKey ( :subjectId ) .

:codeString a owl:DatatypeProperty , owl:FunctionalProperty ;
    rdfs:domain [ a owl:Class ;
                  owl:unionOf ( :Code :Event )
                ] ;
    rdfs:range xsd:string ;
    rdfs:comment "Canonical textual code; functional for Code. Also present on Event when no Code metadata exists." .

:Code owl:hasKey ( :codeString ) .

:time a owl:DatatypeProperty ;
    rdfs:label "time" ;
    rdfs:domain :Event ;
    rdfs:range xsd:dateTime ;
    rdfs:comment "Timestamp of the event. MEDS allows null for static events; modelled as 0..1 cardinality." .

:codeDescription a owl:DatatypeProperty ;
    rdfs:label "codeDescription" ;
    rdfs:domain :Code ;
    rdfs:range xsd:string ;
    rdfs:comment "Human readable description of the code." .

:numericValue a owl:DatatypeProperty ;
    rdfs:label "numericValue" ;
    rdfs:domain :Event ;
    rdfs:range xsd:double ;
    rdfs:comment "Numeric event value (optional in MEDS)." .

:textValue a owl:DatatypeProperty ;
    rdfs:label "textValue" ;
    rdfs:domain :Event ;
    rdfs:range xsd:string ;
    rdfs:comment "Text event value (optional in MEDS)." .

:predictionTime a owl:DatatypeProperty ;
    rdfs:label "predictionTime" ;
    rdfs:domain :LabelSample ;
    rdfs:range xsd:dateTime ;
    rdfs:comment "Inclusive endpoint of the data usable for predicting the label (required for LabelSample)." .

:booleanValue a owl:DatatypeProperty ;
    rdfs:label "booleanValue" ;
    rdfs:domain :LabelSample ;
    rdfs:range xsd:boolean ;
    rdfs:comment "Boolean label value (if applicable)." .

:integerValue a owl:DatatypeProperty ;
    rdfs:label "integerValue" ;
    rdfs:domain :LabelSample ;
    rdfs:range xsd:integer ;
    rdfs:comment "Integer label value (e.g., ordinal labels)." .

:floatValue a owl:DatatypeProperty ;
    rdfs:label "floatValue" ;
    rdfs:domain :LabelSample ;
    rdfs:range xsd:double ;
    rdfs:comment "Float label value (continuous target)." .

:categoricalValue a owl:DatatypeProperty ;
    rdfs:label "categoricalValue" ;
    rdfs:domain :LabelSample ;
    rdfs:range xsd:string ;
    rdfs:comment "Categorical label encoded as a string." .

:rawSourceIdColumn a owl:DatatypeProperty ;
    rdfs:label "rawSourceIdColumn" ;
    rdfs:domain :DatasetMetadata ;
    rdfs:range xsd:string ;
    rdfs:comment "Raw source ID column before mapping to subject IDs. OPTIONAL. One triple per column. Matches MEDS: raw_source_id_columns." .

:codeModifierColumn a owl:DatatypeProperty ;
    rdfs:label "codeModifierColumn" ;
    rdfs:domain :DatasetMetadata ;
    rdfs:range xsd:string ;
    rdfs:comment "Column used to modify/augment code values. OPTIONAL. One triple per column. Matches MEDS: code_modifier_columns." .

:additionalValueModalityColumn a owl:DatatypeProperty ;
    rdfs:label "additionalValueModalityColumn" ;
    rdfs:domain :DatasetMetadata ;
    rdfs:range xsd:string ;
    rdfs:comment "Column containing additional value modality (image, waveform, etc.). OPTIONAL. One triple per column. Matches MEDS: additional_value_modality_columns." .

:siteIdColumn a owl:DatatypeProperty ;
    rdfs:label "siteIdColumn" ;
    rdfs:domain :DatasetMetadata ;
    rdfs:range xsd:string ;
    rdfs:comment "Column representing a site identifier. OPTIONAL. One triple per column. Previously siteIdColumns." .

:subjectIdColumn a owl:DatatypeProperty ;
    rdfs:label "subjectIdColumn" ;
    rdfs:domain :DatasetMetadata ;
    rdfs:range xsd:string ;
    rdfs:comment "Column used as a subject identifier. REQUIRED. One triple per column. Previously subjectIdColumns." .

:otherExtensionColumn a owl:DatatypeProperty ;
    rdfs:label "otherExtensionColumn" ;
    rdfs:domain :DatasetMetadata ;
    rdfs:range xsd:string ;
    rdfs:comment "Other dataset-specific extension column not covered elsewhere. OPTIONAL. One triple per column. Matches MEDS: other_extension_columns." .

:medsVersion a owl:DatatypeProperty ;
    rdfs:label "medsVersion" ;
    rdfs:domain :DatasetMetadata ;
    rdfs:range xsd:string ;
    rdfs:comment "Version of the MEDS schema used to generate the dataset. REQUIRED. Matches MEDS: meds_version." .

################################################################
# Canonical split individuals
################################################################
:trainSplit a :SubjectSplit ; rdfs:label "train"@en .
:tuningSplit a :SubjectSplit ; rdfs:label "tuning"@en .
:heldOutSplit a :SubjectSplit ; rdfs:label "held_out"@en .